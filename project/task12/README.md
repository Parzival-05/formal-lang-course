# **GraphLang Typechecker**

`GraphLangTyper` — типизатор для GraphLang, реализованный с помощью паттерна Visitor. Он проходит по дереву программы, проверяет и выводит типы, а также отслеживает переменные через `VariableStore`.

---

## **Класс `GraphLangTyper`**

### **Инициализация**

- **`__init__`**: Инициализирует объект тайпчекера и создаёт хранилище переменных.

### **Основные методы**

- **Методы `visit*`**: Обрабатывают узлы дерева программы.
  - **`visitProg(ctx)`**, **`visitStmt(ctx)`**: Обрабатывают программы и выражения.
  - **`visitDeclare(ctx)`**, **`visitAdd(ctx)`**, **`visitRemove(ctx)`**: Проверяют корректность операций.
  - **`visitExpr(ctx)`**, **`visitRegexp(ctx)`**, **`visitSelect(ctx)`** и другие: Выводят типы узлов.

### **Проверки**

- Методы вроде **`visitSet_expr(ctx)`**, **`visitVar(ctx)`** и **`__get_var_name(ctx)`** выполняют дополнительные проверки, такие как соответствие переменных их типам.

---

## **Типы**

Типизатор поддерживает следующие типы данных:

- **`GRAPH`**: Граф.
- **`EDGE`**: Ребро графа.
- **`NUM`**: Число.
- **`CHAR`**: Символ.
- **`FA`**: Конечный автомат.
- **`RSM`**: Рекурсивный автомат.
- **`SET`**: Множество чисел.
- **`PAIR_SET`**: Множество пар чисел.
- **`RANGE`**: Диапазон.

---

## **Обработка ошибок**

Типизатор выбрасывает исключения в следующих случаях:

1. **Необъявленные переменные**: Использование переменной до её объявления.
2. **Несоответствие типов**: Несовместимость типов при выполнении операций.
3. **Некорректные операции**: Например, попытка добавить ребро в объект, который не является графом.

---

## **Пример использования**

```python
types_visitor = GraphLangTyper()

try:
    types_visitor.visit(tree)
except Exception as ex:
    logging.error(e, exc_info=True)
```

# GraphLang Runner

## Обзор

`GraphLang Runner` — это интерпретатор для GraphLang, использующий паттерн Visiter. Он проходит по всему дереву и исполняет отдельно каждую операцию.

---

### Класс GraphLangRunner

`GraphLangRunner` — это основной класс, который обрабатывает все операции. Он наследуется от `GraphVisitor`.

### Переменные

Переменные используются для хранения графов, конечных автоматов и других значений. Объявленные переменные сохраняются в словаре:

```python
self.__variables = {}
```

### Регулярные выражения

Регулярные выражения представляются в виде `EpsilonNFA`. Если в регулярном выражении встречается переменная, она записывается как обычный символ, но заглавными буквами.

Когда появляется необходимость выполнить запрос `select`, автоматы объединяются в один `RecursiveAutomata`. В нём происходит подставновка автоматов вместо заглавных букв (нетерминалов). То есть подстановка происходит в момент, когда значения всех переменных уже известны.

### Запросы к графам

Метод `visitSelect` обрабатывает запросы к графам. Он:

1. Определяет стартовые и конечные узлы на основе фильтров (`FOR`).
2. Строит автомат запросов, используя функцию`build_rsm`.
3. Выполняет алгоритм CFPQ (`tensor_based_cfpq`) для получения результатов.


### Пример использования

```python
        runner_visitor = GraphLangRunner()

        try:
            types_visitor.visit(tree)
        except Exception as e:
            logging.error(e, exc_info=True)
```
